<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://user-images.githubusercontent.com/9554297/83762004-a0761b00-a6a9-11ea-83b4-9c8ff721d4b8.png"
    />
    <link rel="stylesheet" href="/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>Covariance and Invariance - qingyingliu</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/client/java/covariance and invariance" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://user-images.githubusercontent.com/9554297/83762004-a0761b00-a6a9-11ea-83b4-9c8ff721d4b8.png&#x27;)" href="/">qingyingliu</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/front-end">前端技术</a></span><span><a aria-current="page" class="active" href="/client">客户端技术</a></span><span><a href="/english">英语</a></span><span><a href="/life">生活</a></span><span><a href="/tools">工具</a></span><span><a href="/psychology">心理学</a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://user-images.githubusercontent.com/9554297/83762004-a0761b00-a6a9-11ea-83b4-9c8ff721d4b8.png&#x27;)" href="/"></a><h1>qingyingliu</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/front-end">前端技术</a></li><li><a aria-current="page" class="active" href="/client">客户端技术</a></li><li><a href="/english">英语</a></li><li><a href="/life">生活</a></li><li><a href="/tools">工具</a></li><li><a href="/psychology">心理学</a></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/client">客户端</a></li><li><a href="/client/android">Android</a><ul><li><a href="/client/android/action bar"><span>Difference Between AppBar, ActionBar, and Toolbar in Android</span></a></li><li><a href="/client/android/android 事件分发机制"><span>Android 事件分发机制</span></a></li><li><a href="/client/android/implicit intent"><span>Implicit intents</span></a></li><li><a href="/client/android/ipc"><span>IPC</span></a></li><li><a href="/client/android/pro-gaurd 文件"><span>progaurd-rules</span></a></li></ul></li><li><a href="/client/architecture-pattern">Architecture-pattern</a><ul><li><a href="/client/architecture-pattern/mvc"><span>Model</span></a></li></ul></li><li><a href="/client/c++">C++</a><ul><li><a href="/client/c++"><span>介绍</span></a></li><li><a href="/client/c++/lvalues and rvalues"><span>Lvalues and Rvalues</span></a></li></ul></li><li><a href="/client/design-pattern/behavioral-patterns">Design-pattern</a><ul><li><a href="/client/design-pattern/behavioral-patterns/状态模式"><span>状态模式</span></a></li></ul></li><li><a aria-current="page" class="active" href="/client/java">Java</a><ul><li><a href="/client/java/annotations"><span>Annotations</span></a></li><li><a aria-current="page" class="active" href="/client/java/covariance and invariance"><span>Covariance and Invariance</span></a></li><li><a href="/client/java/error and exception"><span>Error and Exception</span></a></li><li><a href="/client/java/泛型"><span>泛型</span></a></li></ul></li><li><a href="/client/sql">Sql</a><ul><li><a href="/client/sql/join"><span>SQL Join Types - Inner Join VS Outer Join</span></a></li></ul></li><li><a href="/client/踩坑指南">踩坑指南</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="Covariance and Invariance" data-depth="2"><a href="/client/java/covariance and invariance#covariance-and-invariance"><span>Covariance and Invariance</span></a></li><li title="why" data-depth="2"><a href="/client/java/covariance and invariance#why"><span>why</span></a></li><li title="Covariance, Contravariance and Invariance" data-depth="2"><a href="/client/java/covariance and invariance#covariance-contravariance-and-invariance"><span>Covariance, Contravariance and Invariance</span></a></li><li title="Covariance" data-depth="3"><a href="/client/java/covariance and invariance#covariance"><span>Covariance</span></a></li><li title="Controvariance" data-depth="3"><a href="/client/java/covariance and invariance#controvariance"><span>Controvariance</span></a></li><li title="Invariance" data-depth="3"><a href="/client/java/covariance and invariance#invariance"><span>Invariance</span></a></li><li title="Java 中的 Covariance, Contravariance 和 Invariance" data-depth="3"><a href="/client/java/covariance and invariance#java-中的-covariance-contravariance-和-invariance"><span>Java 中的 Covariance, Contravariance 和 Invariance</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h2 id="covariance-and-invariance"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#covariance-and-invariance"><span class="icon icon-link"></span></a>Covariance and Invariance</h2><p>An ArrayStoreException is a runtime exception in Java that occurs when an attempt is made to store the incorrect type of object into an array of objects. For example, if an Integer object is attempted to be stored in an String array, a “java.lang.ArrayStoreException: java.lang.Integer” is thrown.</p><div class="__dumi-default-code-block"><pre class="prism-code language-java"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">import java.util.Arrays;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">public class ArrayStoreExceptionExample {</span></div><div class="token-line"><span class="token plain">    public static void main(String[] args) {</span></div><div class="token-line"><span class="token plain">        Object[] array = new String[2];</span></div><div class="token-line"><span class="token plain">        array[0] = 5;</span></div><div class="token-line"><span class="token plain">        array[1] = &quot;abc&quot;;</span></div><div class="token-line"><span class="token plain">        Arrays.stream(array).forEach(System.out::println);</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">}</span></div></pre></div><p>Running the above code produces the following output:</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">Exception in thread &quot;main&quot; java.lang.ArrayStoreException: java.lang.Integer</span></div><div class="token-line"><span class="token plain">	at ArrayStoreExceptionExample.main(ArrayStoreExceptionExample.java:6)</span></div></pre></div><p>However, it won&#x27;t throw exception if you new an <code>Object</code> array.</p><div class="__dumi-default-code-block"><pre class="prism-code language-java"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">import java.util.Arrays;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">public class ArrayStoreExceptionExample {</span></div><div class="token-line"><span class="token plain">    public static void main(String[] args) {</span></div><div class="token-line"><span class="token plain">        Object[] array = new Object[2];</span></div><div class="token-line"><span class="token plain">        array[0] = 5;</span></div><div class="token-line"><span class="token plain">        array[1] = &quot;abc&quot;;</span></div><div class="token-line"><span class="token plain">        Arrays.stream(array).forEach(System.out::println);</span></div><div class="token-line"><span class="token plain">    }</span></div><div class="token-line"><span class="token plain">}</span></div></pre></div><h2 id="why"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#why"><span class="icon icon-link"></span></a>why</h2><p>Because arrays in Java are covariant, generic types are invariant instead.</p><h2 id="covariance-contravariance-and-invariance"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#covariance-contravariance-and-invariance"><span class="icon icon-link"></span></a>Covariance, Contravariance and Invariance</h2><h3 id="covariance"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#covariance"><span class="icon icon-link"></span></a>Covariance</h3><p>协变（Covariance）是一种类型系统的特性，指的是子类型的关系与其父类型之间的兼容性。在协变中，可以将子类型的实例赋值给父类型的引用，而不需要进行类型转换。简单来说，协变允许使用更具体的类型替代较为一般的类型。</p><p>在编程语言中，协变通常与继承、泛型和函数返回类型有关。下面以几个例子来说明协变的概念：</p><ol><li><p>继承关系中的协变：假设有一个类 A 和它的子类 B，如果可以将 B 类型的实例赋值给 A 类型的引用，那么就可以说在这个继承关系中存在协变。</p></li><li><p>数组的协变：在某些编程语言中，数组是协变的。例如，在 Java 中，如果 B 是 A 的子类型，那么 B[] 类型的数组可以赋值给 A[] 类型的数组引用。</p></li><li><p>泛型的协变：在支持泛型的语言中，可以使用协变来确保泛型类型参数的一致性。例如（Java 的范型不支持协变），如果 B 是 A 的子类型，那么 <code>List&lt;B&gt;</code>可以赋值给 <code>List&lt;A&gt;</code>，这样就允许使用更具体的类型。</p></li><li><p>函数返回类型的协变：在某些编程语言中，函数的返回类型可以是其返回类型的子类型。例如，在 Java 中，如果一个父类的方法返回类型是 A，而子类中重写该方法时返回类型是 B，那么就存在协变。</p></li></ol><p>协变提供了更灵活和方便的编程方式，可以在不引入类型转换的情况下处理多态和继承关系。它使得代码更易读、更易扩展，并提供了更好的类型安全性。然而，协变也需要小心使用，因为类型的兼容性需要在语言的类型系统中得到支持，而且需要遵循特定的规则和语法。</p><h3 id="controvariance"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#controvariance"><span class="icon icon-link"></span></a>Controvariance</h3><p>逆变（Contravariance）是一种类型系统的特性，与协变相反。在逆变中，可以将父类型的实例赋值给子类型的引用，而不需要进行类型转换。简单来说，逆变允许使用更一般的类型替代较为具体的类型。</p><p>逆变通常与函数参数类型和方法参数类型有关。下面通过几个例子来说明逆变的概念：</p><ol><li><p>继承关系中的逆变：假设有一个类 A 和它的子类 B，如果可以将 A 类型的实例赋值给 B 类型的引用，那么就可以说在这个继承关系中存在逆变。</p></li><li><p>函数参数类型的逆变：在某些编程语言中，函数的参数类型可以是其参数类型的超类型。例如，在 Java 的函数式接口中，如果一个函数接口 <code>Function&lt;B, R&gt;</code>中的参数类型是 B，而另一个函数接口 <code>Consumer&lt;A&gt;</code>中的参数类型是 A，那么 <code>Function&lt;B, R&gt;</code>可以赋值给 <code>Consumer&lt;A&gt;</code>，这样就允许使用更一般的类型。</p></li><li><p>方法参数类型的逆变：在一些语言中，方法的参数类型也可以是其参数类型的超类型。这允许子类方法接受比父类方法更一般的类型。这在一些回调或事件处理的场景中很常见。</p></li></ol><p>逆变提供了一种更灵活和通用的编程方式，可以在不引入类型转换的情况下处理多态和继承关系。它可以使代码更具扩展性和复用性，并提供更好的类型安全性。然而，逆变需要在语言的类型系统中得到支持，并需要遵循特定的规则和语法。不同编程语言对逆变的支持程度和语法可能有所不同。</p><h3 id="invariance"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#invariance"><span class="icon icon-link"></span></a>Invariance</h3><p>不变（Invariance）是一种类型系统的特性，与协变和逆变相对。在不变中，类型之间没有任何子类型或父类型的关系，类型之间不可互相赋值，除非进行类型转换。</p><p>在不变的情况下，无法将一个类型的实例直接赋值给另一个类型的引用，即使它们之间存在继承或关联关系。必须使用显式的类型转换来实现类型之间的转换。</p><p>不变性在保证类型安全性方面提供了一定的保障，因为它限制了类型之间的赋值操作，可以避免一些潜在的类型不兼容的错误。然而，不变性也可能导致一些使用上的不便，因为在需要进行类型转换时需要显式地编写转换代码。</p><p>许多编程语言中的类和对象通常是不变的，例如 Java 中的普通类和对象。这意味着无法将一个对象直接赋值给另一个类或对象的引用，除非进行类型转换。</p><p>需要注意的是，有些编程语言中提供了一些特殊的语法或机制来实现某种形式的类型变化，例如 C#中的协变和逆变修饰符（in 和 out 关键字）。这些机制可以在特定的上下文中实现类型之间的一定程度的转换，但仍然需要遵循语言规范和类型系统的限制。</p><h3 id="java-中的-covariance-contravariance-和-invariance"><a aria-hidden="true" tabindex="-1" href="/client/java/covariance and invariance#java-中的-covariance-contravariance-和-invariance"><span class="icon icon-link"></span></a>Java 中的 Covariance, Contravariance 和 Invariance</h3><p>在 Java 中，以下是一些常见的类型和场景，它们支持协变、逆变或不变的特性：</p><p>协变（Covariant）：</p><ol><li>数组：Java 中的数组是协变的，即可以将子类型的数组赋值给父类型的数组引用。</li><li>通配符上界：通过使用通配符（? extends T）作为泛型的上界，可以实现协变。这允许将具体类型的集合赋值给其父类型的引用。</li><li>返回类型：在方法的重写中，子类方法可以返回比父类方法更具体的类型。</li></ol><blockquote><p>注意：虽然通配符上界的范型支持协变，但对于该范型来说，无法进行写操作（添加或修改集合元素），因为具体类型是未知的。因此，通配符上界主要用于读取集合中的元素，以获取父类型的数据。这也就解释了，为什么通配符上界支持协变：因为无法修改元素的类型。</p></blockquote><p>逆变（Contravariant）：</p><ol><li>通配符下界：通过使用通配符（? super T）作为泛型的下界，可以实现逆变。这允许将具体类型的集合赋值给其子类型的引用。</li><li>方法参数类型：在方法重载中，可以使用逆变来实现更一般的方法参数类型。</li></ol><p>不变（Invariant）：</p><ol><li>类和对象：Java 中的类和对象是不变的，即一个类的实例不能直接赋值给另一个类的引用，除非进行类型转换。</li><li>泛型类和接口：Java 中的泛型类和接口默认是不变的。即使一个类 B 是类 A 的子类型，<code>Box&lt;B&gt;</code>和 <code>Box&lt;A&gt;</code>之间也没有任何继承关系。 需要注意的是，尽管在某些场景中支持协变和逆变，但在使用时需要小心谨慎。不当的使用可能导致类型安全性问题或运行时错误。因此，在使用协变和逆变时，应遵循语言规范和类型系统的限制，并确保类型之间的兼容性。</li></ol></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="最后更新时间：">1/21/2024 13:18:24</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/index.js" defer="true"></script>
    <script src="/umi.1544d070.js"></script>
  </body>
</html>
